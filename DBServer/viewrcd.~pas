unit viewrcd;

interface

uses
  svn, Windows, Messages, SysUtils, Classes, Graphics,
  Controls, Forms, Dialogs, StdCtrls,TabNotBk,Grids,ExtCtrls,Buttons,
  ComCtrls, HumDB,Grobal2,HUtil32;
type
  TFrmFDBViewer=class(TForm)
    TabbedNotebook1: TTabbedNotebook;
    HumanGrid: TStringGrid;
    BagItemGrid: TStringGrid;
    UseMagicGrid: TStringGrid;
    SaveItemGrid: TStringGrid;
    procedure FormCreate(Sender : TObject);
    procedure BtnReadOnlyClick(Sender : TObject);
    procedure BtnApplyClick(Sender : TObject);
    procedure ResetPositionClick(Sender : TObject);




    procedure _PROC_0049B9E4(Sender : TObject);
    procedure _PROC_0049BB54(Sender : TObject);
    procedure _PROC_0049BB84(Sender : TObject);
  private
    procedure sub_49A0C0();
    procedure sub_49A9DC();
    procedure sub_49AA84();
    procedure sub_49AB10();
    procedure ShowBagItem(nIndex:Integer;sName:String;Item:TUserItem);

    procedure ShowBagItems();
    procedure ShowUseMagic();
    procedure ShowSaveItem();
    procedure ShowHumanInfo();
    { Private declarations }
  public
    n2F8:Integer;
    s2FC:String;
    ChrRecord:THumDataInfo;
    procedure ShowHumData();
    { Public declarations }
  end ;

var
  FrmFDBViewer: TFrmFDBViewer;

{This file is generated by DeDe Ver 3.50.02 Copyright (c) 1999-2002 DaFixer}

implementation



{$R *.DFM}

procedure TFrmFDBViewer.FormCreate(Sender : TObject);
//0x0049A024
begin
  sub_49A0C0();
  sub_49A9DC();
  sub_49AA84();
  sub_49AB10();
end;

procedure TFrmFDBViewer.BtnReadOnlyClick(Sender : TObject);
begin
//
end;

procedure TFrmFDBViewer.BtnApplyClick(Sender : TObject);
begin
//
end;

procedure TFrmFDBViewer.ResetPositionClick(Sender : TObject);
begin
//
end;

procedure TFrmFDBViewer.ShowHumData();
begin
  if HumanGrid.Visible then    ShowHumanInfo();
  if BagItemGrid.Visible then  ShowBagItems();
  if UseMagicGrid.Visible then ShowUseMagic();
  if SaveItemGrid.Visible then ShowSaveItem();
end;

procedure TFrmFDBViewer.sub_49A0C0();
begin
  HumanGrid.Cells[0, 1] := '±¸ºÐ';
  HumanGrid.Cells[1, 1] := 'Ä³¸¯¸í';
  HumanGrid.Cells[2, 1] := 'ÇöÀç¸Ê';
  HumanGrid.Cells[3, 1] := 'CX';
  HumanGrid.Cells[4, 1] := 'CY';
  HumanGrid.Cells[5, 1] := '¹æÇâ';
  HumanGrid.Cells[6, 1] := 'Á÷¾÷';
  HumanGrid.Cells[7, 1] := '¼ºº°';
  HumanGrid.Cells[8, 1] := 'Çì¾î';
  HumanGrid.Cells[9, 1] := '±ÝÀü';
  HumanGrid.Cells[10,1]:='GameGold';
  HumanGrid.Cells[11,1]:='Credits';

  HumanGrid.Cells[0,3]:='Home';
  HumanGrid.Cells[1,3]:='HomeX';
  HumanGrid.Cells[2,3]:='HomeY';
  HumanGrid.Cells[3, 3] := '·¹º§';
  HumanGrid.Cells[4,3]:='AC';
  HumanGrid.Cells[5,3]:='MAC';

  HumanGrid.Cells[6,3]:='DC/1';
  HumanGrid.Cells[7,3]:='DC/2';
  HumanGrid.Cells[8,3]:='MC/1';
  HumanGrid.Cells[9,3]:='MC/2';
  HumanGrid.Cells[10,3]:='SC/1';
  HumanGrid.Cells[11,3]:='SC/2';

  HumanGrid.Cells[0,5]:='HP';
  HumanGrid.Cells[1,5]:='MaxHP';
  HumanGrid.Cells[2,5]:='MP';
  HumanGrid.Cells[3,5]:='MaxMP';
  HumanGrid.Cells[4,5]:='Exp';
  HumanGrid.Cells[5,5]:='MaxExp';
  HumanGrid.Cells[6,5]:='PK-Point';
  HumanGrid.Cells[7,5] := 'Ã¢°í¾ÏÈ£';
  HumanGrid.Cells[8,5] := '¿µ¿õ¿©ºÎ';
  HumanGrid.Cells[9,5] := 'PCÆ÷ÀÎÆ®';
  HumanGrid.Cells[10,5] := '¸¶Áö¸··Î±×ÀÎ';
end;

procedure TFrmFDBViewer.sub_49A9DC();
begin
  BagItemGrid.Cells[0, 0] := '±¸ºÐ';
  BagItemGrid.Cells[1, 0] := 'MakeIndex';
  BagItemGrid.Cells[2, 0] := 'wIndex';
  BagItemGrid.Cells[3, 0] := '³»±¸';
end;

procedure TFrmFDBViewer.sub_49AA84();
begin
  SaveItemGrid.Cells[0, 0] := 'MakeIndex';
  SaveItemGrid.Cells[1, 0] := 'wIndex';
  SaveItemGrid.Cells[2, 0] := '³»±¸';
end;

procedure TFrmFDBViewer.sub_49AB10();
begin
  UseMagicGrid.Cells[0, 0] := '¹«°øID';
  UseMagicGrid.Cells[1, 0] := '·¹º§';
  UseMagicGrid.Cells[2, 0] := 'Å°°ª';
  UseMagicGrid.Cells[3, 0] := '¼ö·ÃÆ÷ÀÎÆ®';
end;

procedure TFrmFDBViewer.ShowBagItem(nIndex:Integer;sName:String;Item:TUserItem);
begin
  if Item.wIndex > 0 then begin
    BagItemGrid.Cells[0,nIndex]:=sName;
    BagItemGrid.Cells[1,nIndex]:=IntToStr(Item.MakeIndex);
    BagItemGrid.Cells[2,nIndex]:=IntToStr(Item.wIndex);
    BagItemGrid.Cells[3,nIndex]:=IntToStr(Item.Dura) + '/' + IntToStr(Item.DuraMax);
  end else begin
    BagItemGrid.Cells[0,nIndex]:=sName;
    BagItemGrid.Cells[1,nIndex]:='';
    BagItemGrid.Cells[2,nIndex]:='';
    BagItemGrid.Cells[3,nIndex]:='';
  end;


end;
procedure TFrmFDBViewer.ShowHumanInfo();
var
  HumData:pTHumData;
begin
  HumData:=@ChrRecord.Data;
  HumanGrid.Cells[0,2]:=IntToStr(n2F8);
  HumanGrid.Cells[1,2]:=HumData.sChrName;
  HumanGrid.Cells[2,2]:=HumData.sCurMap;
  HumanGrid.Cells[3,2]:=IntToStr(HumData.wCurX);
  HumanGrid.Cells[4,2]:=IntToStr(HumData.wCurY);
  HumanGrid.Cells[5,2]:=IntToStr(HumData.btDir);
  HumanGrid.Cells[6,2]:=IntToStr(HumData.btJob);
  HumanGrid.Cells[7,2]:=IntToStr(HumData.btSex);
  HumanGrid.Cells[8,2]:=IntToStr(HumData.btHair);
  HumanGrid.Cells[9,2]:=IntToStr(HumData.nGold);
  HumanGrid.Cells[10,2]:=IntToStr(HumData.nGameGold);
  if not HumData.boIsHero then begin
    HumanGrid.Cells[11, 1] := '';
    HumanGrid.Cells[11, 2] := '';
  end else begin
    HumanGrid.Cells[11, 1] := '°ø°Ý¹æ½Ä';
    HumanGrid.Cells[11, 2] := IntToStr(HumData.btAiMode);
  end;

  HumanGrid.Cells[0,4]:=HumData.sHomeMap;
  HumanGrid.Cells[1,4]:=IntToStr(HumData.wHomeX);
  HumanGrid.Cells[2,4]:=IntToStr(HumData.wHomeY);
  HumanGrid.Cells[3,4]:=IntToStr(HumData.Abil.Level);
  HumanGrid.Cells[4,4]:=IntToStr(LoWord(HumData.Abil.AC)) + '-' + IntToStr(HiWord(HumData.Abil.AC));
  HumanGrid.Cells[5,4]:=IntToStr(LoWord(HumData.Abil.MAC)) + '-' + IntToStr(HiWord(HumData.Abil.MAC));

  HumanGrid.Cells[6,4]:=IntToStr(LoWord(HumData.Abil.DC));
  HumanGrid.Cells[7,4]:=IntToStr(HiWord(HumData.Abil.DC));
  HumanGrid.Cells[8,4]:=IntToStr(LoWord(HumData.Abil.MC));
  HumanGrid.Cells[9,4]:=IntToStr(HiWord(HumData.Abil.MC));
  HumanGrid.Cells[10,4]:=IntToStr(LoWord(HumData.Abil.SC));
  HumanGrid.Cells[11,4]:=IntToStr(HiWord(HumData.Abil.SC));
  if not HumData.boIsHero then begin
    if HumData.sHeroChrName <> '' then begin
      HumanGrid.Cells[11, 5] := '¿µ¿õÀÌ¸§';
      HumanGrid.Cells[11, 6] := HumData.sHeroChrName;
    end else begin
      HumanGrid.Cells[11, 5] := '¿µ¿õ¾øÀ½';
      HumanGrid.Cells[11, 6] := '';
    end;
  end else begin
    HumanGrid.Cells[11, 5] := '¿µ¿õµî±Þ';
    HumanGrid.Cells[11, 6] := IntToHeroGrade(HumData.nHeroGrade);
  end;
  HumanGrid.Cells[0,6]:=IntToStr(HumData.Abil.HP);
  HumanGrid.Cells[1,6]:=IntToStr(HumData.Abil.HP);
  HumanGrid.Cells[2,6]:=IntToStr(HumData.Abil.MaxMP);
  HumanGrid.Cells[3,6]:=IntToStr(HumData.Abil.MaxMP);
  HumanGrid.Cells[4,6]:=IntToStr(HumData.Abil.Exp);
  HumanGrid.Cells[5,6]:=IntToStr(HumData.Abil.MaxExp);
  HumanGrid.Cells[6,6]:=IntToStr(HumData.nPKPoint);
  HumanGrid.Cells[7,6] :=HumData.sStoragePwd;
  HumanGrid.Cells[8,6] := BoolToStr(HumData.boIsHero);
  HumanGrid.Cells[9,6]:=IntToStr(HumData.nPCPoint);
  HumanGrid.Cells[10,6]:=DateTimeToStr(ChrRecord.Header.dCreateDate);


end;
//0049B295
procedure TFrmFDBViewer.ShowBagItems();
var
  i,ii:Integer;
begin
  for i:= 1 to BagItemGrid.RowCount - 1 do begin
    for ii:= 0 to BagItemGrid.ColCount - 1 do begin
      BagItemGrid.Cells[ii,i]:='';
    end;
  end;
  ShowBagItem(1,'¿Ê',ChrRecord.Data.HumItems[0]);
  ShowBagItem(2,'¹«±â',ChrRecord.Data.HumItems[1]);
  ShowBagItem(3,'È¶ºÒ',ChrRecord.Data.HumItems[2]);
  ShowBagItem(4,'¸ñ°ÉÀÌ',ChrRecord.Data.HumItems[3]);
  ShowBagItem(5,'Åõ±¸',ChrRecord.Data.HumItems[4]);
  ShowBagItem(6,'(¿Þ)ÆÈÂî',ChrRecord.Data.HumItems[5]);
  ShowBagItem(7,'(¿À)ÆÈÂî',ChrRecord.Data.HumItems[6]);
  ShowBagItem(8,'(¿Þ)¹ÝÁö',ChrRecord.Data.HumItems[7]);
  ShowBagItem(9,'(¿À)¹ÝÁö',ChrRecord.Data.HumItems[8]);
  ShowBagItem(10,'ºÎÀû',ChrRecord.Data.HumItems[9]);
  ShowBagItem(11,'º§Æ®',ChrRecord.Data.HumItems[10]);
  ShowBagItem(12,'½Å¹ß',ChrRecord.Data.HumItems[11]);
  ShowBagItem(13,'¼öÈ£¼®',ChrRecord.Data.HumItems[12]);
  for i:= Low(ChrRecord.Data.BagItems) to High(ChrRecord.Data.BagItems) do begin
    ShowBagItem(i + 13,IntToStr(i + 1),ChrRecord.Data.BagItems[i]);
  end;
end;

procedure TFrmFDBViewer.ShowUseMagic();
//0x0049B4D8
var
  i,ii:Integer;
begin
  for i:= 1 to UseMagicGrid.RowCount - 1 do begin
    for ii:= 0 to UseMagicGrid.ColCount - 1 do begin
      UseMagicGrid.Cells[ii,i]:='';
    end;
  end;
  for I := Low(ChrRecord.Data.Magic) to High(ChrRecord.Data.Magic) do begin
    if ChrRecord.Data.Magic[i].wMagIdx <= 0 then break;
    UseMagicGrid.Cells[0,i+ 1]:=IntToStr(ChrRecord.Data.Magic[i].wMagIdx);
    UseMagicGrid.Cells[1,i+ 1]:=IntToStr(ChrRecord.Data.Magic[i].btLevel);
    UseMagicGrid.Cells[2,i+ 1]:=Chr(ChrRecord.Data.Magic[i].btKey);
    UseMagicGrid.Cells[3,i+ 1]:=IntToStr(ChrRecord.Data.Magic[i].nTranPoint);
  end;
end;

procedure TFrmFDBViewer.ShowSaveItem();
//0x0049B628
var
  i,ii:Integer;
begin
  for i:= 1 to SaveItemGrid.RowCount - 1 do begin
    for ii:= 0 to SaveItemGrid.ColCount - 1 do begin
      SaveItemGrid.Cells[ii,i]:='';
    end;
  end;
  for I := Low(ChrRecord.Data.StorageItems) to High(ChrRecord.Data.StorageItems) do begin
    if ChrRecord.Data.StorageItems[i].wIndex <= 0 then Continue;
    SaveItemGrid.Cells[0,i+ 1]:=IntToStr(ChrRecord.Data.StorageItems[i].MakeIndex);
    SaveItemGrid.Cells[1,i+ 1]:=IntToStr(ChrRecord.Data.StorageItems[i].wIndex);
    SaveItemGrid.Cells[2,i+ 1]:=IntToStr(ChrRecord.Data.StorageItems[i].Dura) + '/' +
                                IntToStr(ChrRecord.Data.StorageItems[i].DuraMax);
  end;
end;

procedure TFrmFDBViewer._PROC_0049B9E4(Sender : TObject);
begin
(*
0049B9E4   000400                 add     [eax+eax], al
0049B9E7   00558B                 add     [ebp-$75], dl
0049B9EA   EC                     in      al, dx
0049B9EB   83C4F4                 add     esp, -$0C
0049B9EE   8955F4                 mov     [ebp-$0C], edx
0049B9F1   8945F8                 mov     [ebp-$08], eax
0049B9F4   8B4508                 mov     eax, [ebp+$08]
0049B9F7   8B40FC                 mov     eax, [eax-$04]

* Reference to control TFrmFDBViewer.BagItemGrid : TStringGrid
|
0049B9FA   8B80D8020000           mov     eax, [eax+$02D8]
0049BA00   8945FC                 mov     [ebp-$04], eax
0049BA03   8BE5                   mov     esp, ebp
0049BA05   5D                     pop     ebp
0049BA06   C3                     ret

*)
end;

procedure TFrmFDBViewer._PROC_0049BB54(Sender : TObject);
begin
(*
0049BB54   55                     push    ebp
0049BB55   8BEC                   mov     ebp, esp
0049BB57   33C0                   xor     eax, eax
0049BB59   55                     push    ebp

* Possible String Reference to: 'é–zöÿëø]Ã‹Àƒ-\ÛJ'
|
0049BB5A   6879BB4900             push    $0049BB79

***** TRY
|
0049BB5F   64FF30                 push    dword ptr fs:[eax]
0049BB62   648920                 mov     fs:[eax], esp
0049BB65   FF055CDB4A00           inc     dword ptr [$004ADB5C]
0049BB6B   33C0                   xor     eax, eax
0049BB6D   5A                     pop     edx
0049BB6E   59                     pop     ecx
0049BB6F   59                     pop     ecx
0049BB70   648910                 mov     fs:[eax], edx

****** FINALLY
|

* Possible String Reference to: ']Ã‹Àƒ-\ÛJ'
|
0049BB73   6880BB4900             push    $0049BB80
0049BB78   C3                     ret


* Reference to: system.@HandleFinally;
|
0049BB79   E9967AF6FF             jmp     00403614
0049BB7E   EBF8                   jmp     0049BB78

****** END
|
0049BB80   5D                     pop     ebp
0049BB81   C3                     ret

*)
end;

procedure TFrmFDBViewer._PROC_0049BB84(Sender : TObject);
begin
(*
0049BB84   832D5CDB4A0001         sub     dword ptr [$004ADB5C], +$01
0049BB8B   C3                     ret

*)
end;


{---- Adjust global SVN revision ----}
initialization
  SVNRevision('$Id: viewrcd.pas 121 2006-08-06 01:10:41Z Dataforce $');
end.